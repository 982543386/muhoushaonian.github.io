---
layout: post
title: 遗传算法实现水文模型参数率定
description: Nope
tag: 智能算法
---

### 背景

课设需求: 课程设计任务为实现萨克拉门托模型在乐安河流域径流预报中的应用

在寒假后两天，完成基础代码，实现在给定参数条件对萨克拉门托模型的实现

但是应用到某特定流域时，为精确分析与预测，需要利用该流域的历史水文资料

引出本文的目的: 在已有1年水文基础数据的条件下，利用智能算法实现参数率定

PS: 其实我觉得全局敏感度分析+人工手动率定也是一个不错的选择，遍历就完事[所以还是看个人需求]

### 知识前备

遗传算法(GA)将问题参数编码为染色体，再利用迭代的方式进行选择、交叉以及变异等运算来交换种群中染色体的信息，最终生成符合优化目标的染色体。

基本步骤:

    1.编码[GA在进行搜索前先将解空间的截数据表示成遗传空间的基因型串结构数据，这些串结构数据的不同组合便构成不同的点]
    2.初始群体的生成[随机产生N个初始串结构数据，每个串结构数据称为一个个体，N个个体构成了一个群体，GA以这N个串结构数据作为初始点开始进化]
    3.适应度评估[适应度表明个体或解的优劣性。不同的问题，适应性函数的定义方式也不同]
    4.选择[适者生存]
    5.交叉[最主要的遗传操作]
    6.变异[在群体中随机选择一个个体，对选中个体以一定概率随机改变串结构]

### 谢菲尔德遗传算法工具箱

Introduction: 由英国谢菲尔德大学开发的遗传算法工具箱

Download link: https://codem.group.shef.ac.uk/current/index.php/ga-toolbox

PS: 直接点击download按钮不行的话，点击网页上github的超链接[maybe you need a VPN 最近上github体验越来越差了]

Afterdownload:
    1.解压缩，然后放到\matlab\toolbox下
    2.命令行依次输入[str=[matlabroot,'\toolbox\gatbx'];addpath(str)]
    3.在命令行输入[v = ver('gatbx')],若返回不为空,Congratulation!

### 将实际问题抽象为数学模型

将我的模型抽象为函数function Sac();输入参数为遴选参数[实际上需要通过全局敏感度分析来选定参数]

为简化问题(我的游戏还等着我啊喂),我们通过相关资料来初步遴选

为缩小解空间维度的同时保证结果准确性,选定 KC(蒸散发折算系数) UZK(出流系数) PFREE(下渗水量补充自由水的比例) /待定: UZFWM [15,30]/三个参数为解空间的三个维度

根据经验值 初步定下解空间范围 KC∈[0.8,1.0]  UZK∈[0.3,0.5]  PFREE∈[0.2,0.5]

我们选定 **确定性系数（Nash-Sutcliffe model efficiency coefficient）** 来表征模型流量过程线的总体拟合程度

![](/images/post_image/RMSE.png)

显然我们将一个萨克拉门托模型应用的实际问题转化成为一个非线性规划求解问题[写到这里我有点担心电脑带不动23333]

### 利用GA解决该实际问题

1.种群初始化

*由于遗传算法不能直接处理问题空间的参数，因此必须通过编码把要求问题的可行解表示成遗传空间的染色体和个体. 常用的编码方法有位串编码、Grey编码、实数编码、多级参数编码、有序串编码、结构式编码等*

本课设选择实数编码[因为该法无须进行数值转换，可以直接在解的表现型上进行遗传算法操作]

2.适应度函数

确定性系数的倒数的函数值作为个体的适应度值。

函数值越小的个体，适应度值越大，个体越优

3.选择操作

选择操作从旧群体中以一定概率选择优良个体组成新的种群，个体被选中的概率跟适应度值有关。本案例选择轮盘赌法，个体i被选择的概率为:

![](/images/post_image/轮盘赌公式.png)

4.交叉操作

交叉操作是从种群中随机选择两个个体，通过两个染色体的交换组合，把父串的优秀特征遗传给子串，从而产生新的优秀个体。

5.变异操作

变异操作的主要目的是维持种群多样性。

6.非线性寻优

遗传算法迭代计算一次，以遗传算法当前计算的结果为初始值，采用matlab优化工具箱中线性规划函数fmincon进行局部寻优。

### 具体代码:

1.可以在matlab工具箱中选择global optimization然后算法中选择遗传算法，百度文库中有文档进行详细说明。

2.代码实现[上传到自己的github中 项目地址: https://github.com/muhoushaonian/Curriculum-Design-Sacramento-model-/blob/master]


### 参考

[1]	 包为民《水文预报》中国水利电力出版社，2016年12月第五版

[2]	 工程水文学（高等学校教材）

[3]	 MATLAB智能算法30个案例分析（第二版）
